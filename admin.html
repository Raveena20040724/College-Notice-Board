<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Digital Notice Board</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
 
  <!-- ===== College Header ===== -->
  <header class="college-header">
  <img src="images/logo.png" alt="College Logo" class="college-logo">
  <h1 class="college-name">SIR ISSAC NEWTON COLLEGE OF ENGINEERING AND TECHNOLOGY</h1>
</header>


  <h1>üìù Admin Panel - Manage Notices</h1>

  <!-- Form -->
  <form id="noticeForm">
    <input type="hidden" id="editIndex" value="">
    <input type="text" id="title" placeholder="Notice Title" required><br><br>
    <textarea id="content" placeholder="Write your notice..." required></textarea><br><br>
    <input type="file" id="imageUpload" accept="image/*"><br><br>
    <input type="file" id="pdfUpload" accept="application/pdf"><br><br>
    <button type="submit">Post Notice</button>
  </form>

  <hr>

  <!-- Notice List -->
  <h2>üì¢ Posted Notices</h2>
  <div id="notice-board"></div>

  <button onclick="logout()">Logout</button>

  <script src="script.js"></script>
  <script>
    checkAuth("admin"); // ‚úÖ only admin can access

    // Convert file to Base64
    const toBase64 = (file) => new Promise((resolve, reject) => {
      if (!file) return resolve(null);
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = (err) => reject(err);
    });

    // Load notices for admin (with edit + delete buttons)
    function loadNotices() {
      const notices = JSON.parse(localStorage.getItem("notices")) || [];
      const noticeBoard = document.getElementById("notice-board");
      noticeBoard.innerHTML = "";

      if (notices.length === 0) {
        noticeBoard.innerHTML = "<p>No notices posted yet.</p>";
        return;
      }

      notices.forEach((notice, index) => {
        const div = document.createElement("div");
        div.className = "notice";
        div.innerHTML = `
          <h3>${notice.title}</h3>
          <p>${notice.content}</p>
          <small>üìÖ ${new Date(notice.timestamp).toLocaleString()}</small><br>
          ${notice.image ? `<img src="${notice.image}" width="200"><br>` : ""}
          ${notice.pdf ? `<a href="${notice.pdf}" target="_blank" download="notice.pdf">üìÑ Open PDF</a><br>` : ""}
          <button onclick="editNotice(${index})">‚úèÔ∏è Edit</button>
          <button onclick="deleteNotice(${index})">üóëÔ∏è Delete</button>
        `;
        noticeBoard.appendChild(div);
      });
    }

    // Save or Update notice
    document.getElementById("noticeForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const title = document.getElementById("title").value;
      const content = document.getElementById("content").value;
      const imageFile = document.getElementById("imageUpload").files[0];
      const pdfFile = document.getElementById("pdfUpload").files[0];
      const editIndex = document.getElementById("editIndex").value;

      const image = await toBase64(imageFile);
      const pdf = await toBase64(pdfFile);

      let notices = JSON.parse(localStorage.getItem("notices")) || [];

      if (editIndex === "") {
        // New Notice
        const notice = {
          title,
          content,
          image,
          pdf,
          timestamp: new Date().toISOString()
        };
        notices.unshift(notice);
      } else {
        // Update existing
        notices[editIndex].title = title;
        notices[editIndex].content = content;
        if (image) notices[editIndex].image = image; // update only if new file uploaded
        if (pdf) notices[editIndex].pdf = pdf;
      }

      localStorage.setItem("notices", JSON.stringify(notices));

      alert(editIndex === "" ? "‚úÖ Notice posted!" : "‚úèÔ∏è Notice updated!");
      document.getElementById("noticeForm").reset();
      document.getElementById("editIndex").value = "";
      loadNotices();
    });

    // Edit notice
    function editNotice(index) {
      const notices = JSON.parse(localStorage.getItem("notices")) || [];
      const notice = notices[index];

      document.getElementById("title").value = notice.title;
      document.getElementById("content").value = notice.content;
      document.getElementById("editIndex").value = index;
      window.scrollTo(0, 0);
    }

    // Delete notice
    function deleteNotice(index) {
      let notices = JSON.parse(localStorage.getItem("notices")) || [];
      if (confirm("Are you sure you want to delete this notice?")) {
        notices.splice(index, 1);
        localStorage.setItem("notices", JSON.stringify(notices));
        loadNotices();
      }
    }

    loadNotices();
  </script>
</body>
</html>






